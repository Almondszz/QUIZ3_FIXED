{% extends 'base.html' %}
{% block content %}
  {% if not user.is_authenticated %}
    <div class="alert alert-danger mt-4">
      <h3>You are unauthorized!</h3>
      <p>
        <a href="{% url 'admin:login' %}?next={{ request.path }}" class="btn btn-primary">Sign in</a>
      </p>
    </div>
  {% else %}
    <div class="card mt-4 mb-4">
      <div class="card-body">
        {% if job.image %}
          <img src="{{ job.image.url }}" alt="{{ job.job_title }}" class="img-fluid mb-3" style="max-height:200px;">
        {% endif %}
        <h2 class="card-title">{{ job.job_title }}</h2>
        <p><strong>Description:</strong> {{ job.job_description }}</p>
        <p><strong>Location:</strong> {{ job.location }}</p>
        <p><strong>Offer:</strong> {{ job.min_offer }} - {{ job.max_offer }}</p>
      </div>
    </div>

    {% if user.admin %}
      <h3 class="mb-3">Applicants</h3>
      <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
          <thead class="table-dark">
            <tr>
              <th>Username</th>
              <th>Email</th>
              <th>Phone Number</th>
              <th>Applied Date</th>
              <th>Resume</th>
            </tr>
          </thead>
          <tbody>
            {% for applicant in job.jobapplicant_set.all %}
              <tr>
                <td>{{ applicant.user.username }}</td>
                <td>{{ applicant.user.email }}</td>
                <td>{{ applicant.user.phone_number }}</td>
                <td>{{ applicant.applied_date }}</td>
                <td>
                  {% if applicant.resume %}
                    <a href="{{ applicant.resume.url }}" class="btn btn-link">Download</a>
                  {% else %}
                    <span class="text-muted">No Resume</span>
                  {% endif %}
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="5" class="text-center">No applicants yet.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <a href="{% url 'job_update' job.pk %}" class="btn btn-primary">Edit</a>
      <a href="{% url 'job_delete' job.pk %}" class="btn btn-danger">Delete</a>
      <a href="{% url 'job_list' %}" class="btn btn-secondary">Back to List</a>
    {% else %}
      <div class="card mt-4 mb-4">
        <div class="card-body">
          <h4 class="mb-3">Apply to this job</h4>
          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ apply_form.as_p }}
            <button type="submit" class="btn btn-success">Apply</button>
          </form>
          <a href="{% url 'job_list' %}" class="btn btn-secondary mt-3">Back to List</a>
        </div>
      </div>
    {% endif %}
  {% endif %}
{% endblock %}